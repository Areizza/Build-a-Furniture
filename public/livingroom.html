<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.js"></script>
    <script src="https://unpkg.com/aframe-physics-extras@0.1.2/dist/aframe-physics-extras.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.js"></script>
    <script src="https://unpkg.com/super-hands@3.0.0/dist/super-hands.js"></script>
    <script src="scripts/furniture.js"></script>
    <script src="scripts/snap-point.js"></script>
    <script>
        // Prevent context menu.
        document.addEventListener("contextmenu", function (e)
        {
            e.preventDefault();
            console.log("Context menu disabled for right click.")
        }, false);
    </script>
</head>
    <body>
        <a-scene physics="debug: true;">
            <a-assets>
                <!-- load environment models -->
                <a-asset-item id="livingRoom"
                              src="/assets/environments/livingRoom/livingroom.gltf">
                </a-asset-item>

                <!-- load asset models -->
                <a-asset-item id="tableTopModel"
                              src="/assets/models/tableTopConnected/tableTopConnected.gltf">
                </a-asset-item>
                <a-asset-item id="tableLegModel"
                              src="/assets/models/tableLeg/tableLeg.gltf">
                </a-asset-item>

                <!-- load audio files -->
                <audio id="livingRoomAmbiance" crossorigin="anonymous" response-type="arraybuffer"
                       src="assets/sounds/livingRoomAmbiance.ogg" preload="auto"></audio>

                <a-mixin id="sphereCollider"
                         class="snapPoint"
                         geometry="primitive: sphere; radius: 0.10;"
                         material="color: blue; shader: flat; opacity: 0.4;"
                         transparent="true"
                         sphere-collider="objects: .snapPoint; radius: 0.08">
                </a-mixin>

                <a-mixin id="part"
                         hoverable grabbable draggable droppable
                         event-set__hoveron="_event: hover-start; material.opacity: 0.8; transparent: true"
                         event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false">
                </a-mixin>

                <a-mixin id="tableLeg"
                         gltf-model="#tableLegModel"
                         scale="3 3 3"
                         body="type: dynamic; mass: 1; shape: none;"
                         shape__main="shape: box;
                                    halfExtents: 0.036 0.345 0.036;"
                         furniture="tier: 1; totalSnapPoints: 1;"
                         mixin="part">

                </a-mixin>
            </a-assets>

            <a-entity id="livingRoomEnv"
                     gltf-model="#livingRoom"
                      position="0 0 0"
                      scale="3 3 3">
            </a-entity>

            <a-entity id="tableTop"
                      class="grabbable"
                      furniture="tier: 0; totalSnapPoints: 4;"
                      mixin="part"
                      scale="3 3 3"
                      gltf-model="#tableTopModel"
                      body="type: dynamic; mass: 20; shape: none;"
                      shape__main="shape: box;
                                  halfExtents: 0.72 0.061 0.72"
                      position="0 0.09 0"
                      rotation="180 0 0">

                <a-entity position="0.62 -0.07 0.62"
                          class="snapPoint"
                          mixin="sphereCollider"
                          snap-point="snapId: 1; snapTo: 2;">
                </a-entity>
                <a-entity position="-0.62 -0.07 -0.62"
                          class="snapPoint"
                          mixin="sphereCollider"
                          snap-point="snapId: 1; snapTo: 2;">
                </a-entity>
                <a-entity position="-0.62 -0.07 0.62"
                          class="snapPoint"
                          mixin="sphereCollider"
                          snap-point="snapId: 1; snapTo: 2;">
                </a-entity>
                <a-entity position="0.62 -0.07 -0.62"
                          class="snapPoint"
                          mixin="sphereCollider"
                          snap-point="snapId: 1; snapTo: 2;">
                </a-entity>
            </a-entity>

            <!-- Table Legs-->
            <a-entity id="tableLeg_BR"
                      class=grabbable
                      mixin="tableLeg"
                      position="0 0.7 -4">
                <a-entity position="0 0.345 0"
                          class="snapPoint"
                          mixin="sphereCollider"
                          snap-point="snapId: 2; snapTo: 1;">
                </a-entity>
            </a-entity>
            
            <a-entity id="tableLeg_TR"
                      class=grabbable
                      mixin="tableLeg"
                      position="3 0.7 -1.5">
                <a-entity position="0 0.345 0"
                          class="snapPoint"
                          mixin="sphereCollider"
                          snap-point="snapId: 2; snapTo: 1;">
                </a-entity>
            </a-entity>
            <a-entity id="tableLeg_BL"
                      class=grabbable
                      mixin="tableLeg"
                      position="-3.2 0.7 -1">
                <a-entity position="0 0.345 0"
                          class="snapPoint"
                          mixin="sphereCollider"
                          snap-point="snapId: 2; snapTo: 1;">
                </a-entity>
            </a-entity>
            <a-entity id="tableLeg_TL"
                      class=grabbable
                      mixin="tableLeg"
                      position="-2.5 0.7 -4.5">
                <a-entity position="0 0.345 0"
                          class="snapPoint"
                          mixin="sphereCollider"
                          snap-point="snapId: 2; snapTo: 1;">
                </a-entity>
            </a-entity>

            <!-- Camera -->
            <a-entity camera
                      wasd-controls="acceleration: 150"
                      look-controls="pointerLockEnabled:true"
                      position="0 3.2 1.5"
                      capture-mouse
                      static-body="shape: sphere; sphereRadius: 0.0002"
                      super-hands="colliderEvent: raycaster-intersection;
                             colliderEventProperty: els;
                             colliderEndEvent:raycaster-intersection-cleared;
                             colliderEndEventProperty: clearedEls;">
                <a-cursor id="cursor"
                          rayOrigin="entity"
                          far="5"
                          interval="100"
                          objects=".grabbable">
                </a-cursor>
            </a-entity>

            <a-entity id="groundPlane"
                      position="0 -0.01 0"
                      rotation="-90 0 0"
                      scale="1 1.5 1"
                      geometry="primitive: plane; width: 25.0; height: 25.0"
                      material="transparent: true; opacity: 0.0;"
                      static-body
                      shadow>
            </a-entity>
            <a-entity id="frontWall"
                      position="0 3.5 -18"
                      rotation="0 0 0"
                      scale="1 1 1"
                      geometry="primitive: plane; width: 25.0; height: 10.5"
                      material="transparent: true; opacity: 0.0;"
                      static-body
                      shadow>
            </a-entity>
            <a-entity id="leftWall"
                      position="-11.7 4.1 0"
                      rotation="0 90 0"
                      scale="1 1 1"
                      geometry="primitive: plane; width: 36.5; height: 9.4"
                      material="transparent: true; opacity: 0.0;"
                      static-body
                      shadow>
            </a-entity>
            <a-entity id="backWall"
                      position="0 3.5 18"
                      rotation="-180 0 0"
                      scale="1 1 1"
                      geometry="primitive: plane; width: 25.0; height: 10.5"
                      material="transparent: true; opacity: 0.0;"
                      static-body
                      shadow>
            </a-entity>
            <a-entity id="rightWall"
                      position="11.7 4.1 0"
                      rotation="0 -90 0"
                      scale="1 1 1"
                      geometry="primitive: plane; width: 36.5; height: 9.4"
                      material="transparent: true; opacity: 0.0;"
                      static-body
                      shadow>
            </a-entity>

            <!-- Ambient sound plane -->
            <a-entity id="ceilingPlane"
                      position="0 8.5 0"
                      rotation="90 0 0"
                      scale="1 1.5 1"
                      geometry="primitive:plane; width:25; height:25;"
                      material="transparent: true; opacity: 0.0;"
                      sound="src: #livingRoomAmbiance; volume: 10.0; autoplay: true; loop: true;"
                      static-body>
            </a-entity>

            <!-- Lights -->
            <a-entity light="type: point; color: #CCC; intensity: 0.5"
                      position="0 5.8 0">
            </a-entity>

            <a-entity light="type: point; color: #CCC; intensity: 0.15"
                      position="-5.7 3.5 -17">
            </a-entity>

            <a-entity light="type: point; color: #CCC; intensity: 0.15"
                      position="1 5.8 12.2">
            </a-entity>

            <a-entity light="type: ambient; color: #CCC; intensity: 0.7">
            </a-entity>
        </a-scene>
    </body>
</html>